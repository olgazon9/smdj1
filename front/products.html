<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Product List</title>
    <link rel="stylesheet" href="styles.css"> <!-- Link to your CSS file -->
</head>
<body>
    <h1>Product List</h1>
    <div class="card-container">
        <!-- Cards will be added here dynamically -->
    </div>

    <div class="cart">
        <h2>Shopping Cart</h2>
        <ul id="cart-list">
        </ul>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        const cardContainer = document.querySelector('.card-container');
        const cartList = document.getElementById('cart-list');

        // Shopping cart as an object to keep track of selected products
        let cart = {};

        // Variable to store the product data
        let productsData = null;

        // Load cart from local storage if available
        if (localStorage.getItem('cart')) {
            cart = JSON.parse(localStorage.getItem('cart'));
        }

        function updateCart() {
            cartList.innerHTML = '';
            for (const productId in cart) {
                const product = cart[productId];
                const cartItem = document.createElement('li');
                cartItem.innerHTML = `${product.name} (Qty: ${product.quantity})
                    <button onclick="addToCart('${productId}')">+</button>
                    <button onclick="removeFromCart('${productId}')">-</button>`;
                cartList.appendChild(cartItem);
            }
        }

        function addToCart(productId) {
            if (cart[productId]) {
                cart[productId].quantity++;
            } else {
                const product = productsData.find(item => item.id === parseInt(productId));
                cart[productId] = { ...product, quantity: 1 };
            }
            saveCartToLocalStorage();
            updateCart();
        }

        function removeFromCart(productId) {
            if (cart[productId] && cart[productId].quantity > 1) {
                cart[productId].quantity--;
            } else {
                delete cart[productId];
            }
            saveCartToLocalStorage();
            updateCart();
        }

        function saveCartToLocalStorage() {
            localStorage.setItem('cart', JSON.stringify(cart));
        }

        // Make an Axios GET request to fetch the product data
        axios.get('http://127.0.0.1:8000/products/')
            .then(response => {
                productsData = response.data; // Store product data for later use
                productsData.forEach(product => {
                    const card = document.createElement('div');
                    card.classList.add('card');
                    
                    const img = document.createElement('img');
                    img.setAttribute('src', `http://127.0.0.1:8000${product.image}`);
                    img.setAttribute('alt', product.name);
                    card.appendChild(img);
                    
                    const namePrice = document.createElement('div');
                    namePrice.textContent = `Name: ${product.name}, Price: ${product.price}`;
                    card.appendChild(namePrice);
                    
                    // Add a Buy button
                    const buyButton = document.createElement('button');
                    buyButton.textContent = 'Buy';
                    buyButton.addEventListener('click', () => addToCart(product.id));
                    card.appendChild(buyButton);
                    
                    cardContainer.appendChild(card);
                });
                updateCart(); // Update the cart after loading the products
            })
            .catch(error => {
                console.error('Error:', error);
            });
    </script>
</body>
</html>
